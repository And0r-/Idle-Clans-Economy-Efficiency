<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idle Clans Profit Optimizer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #2c3e50;
            color: white;
            border-radius: 8px;
        }
        .summary {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .top-tasks {
            background-color: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #27ae60;
        }
        .category-section {
            background-color: white;
            margin-bottom: 30px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .category-header {
            background-color: #34495e;
            color: white;
            padding: 15px 20px;
            margin: 0;
            font-size: 1.2em;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }
        .profit-positive {
            color: #27ae60;
            font-weight: bold;
        }
        .profit-negative {
            color: #e74c3c;
            font-weight: bold;
        }
        .profit-zero {
            color: #7f8c8d;
        }
        .no-tasks {
            padding: 20px;
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
        }
        .refresh-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px 0;
        }
        .refresh-btn:hover {
            background-color: #2980b9;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        .stat-item {
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        /* Tooltip styles */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #2c3e50;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            white-space: pre-line;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 300px;
            text-align: left;
        }

        .tooltip:hover::before {
            content: '';
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #2c3e50;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="header">
        <div style="position: absolute; top: 20px; right: 20px;">
            <select id="languageSelect" onchange="changeLanguage()" style="padding: 8px; border-radius: 4px; border: 1px solid #bdc3c7; background: white; font-size: 14px;">
                <option value="en">üá¨üáß English</option>
                <option value="de">üá©üá™ Deutsch</option>
            </select>
        </div>
        <h1>üèÜ {{ _('Idle Clans Profit Optimizer') }}</h1>
        <p>{{ _('Real-time market analysis for maximum efficiency') }}</p>
        <button class="refresh-btn" onclick="location.reload()">üîÑ {{ _('Refresh View') }}</button>
    </div>

    <div class="summary">
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number">{{ total_categories }}</div>
                <div class="stat-label">{{ _('Categories') }}</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ total_tasks }}</div>
                <div class="stat-label">{{ _('Total Tasks') }}</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ profitable_tasks }}</div>
                <div class="stat-label">{{ _('Profitable Tasks') }}</div>
            </div>
        </div>

        <div class="top-tasks">
            <h3>ü•á {{ _('Top 5 Most Profitable Tasks') }}</h3>
            {% for task in top_tasks[:5] %}
            <div>
                <strong>{{ loop.index }}. {{ task.display_name or task.name }}</strong> -
                <span class="profit-positive">{{ "%.3f"|format(task.gold_efficiency) }} gold/sec</span>
                ({{ task.category_name }})
            </div>
            {% endfor %}
        </div>
    </div>

    {% for category in categories %}
    <div class="category-section">
        <h2 class="category-header">{{ category.name }}</h2>

        {% if category.tasks_with_data %}
        <table>
            <thead>
                <tr>
                    <th>{{ _('Task Name') }}</th>
                    <th>{{ _('Revenue') }}</th>
                    <th>{{ _('Costs') }}</th>
                    <th>{{ _('Net Profit') }}</th>
                    <th>{{ _('Time (sec)') }}</th>
                    <th>{{ _('Profit/sec') }}</th>
                    <th>{{ _('XP/sec') }}</th>
                </tr>
            </thead>
            <tbody>
                {% for task in category.tasks_with_data %}
                <tr>
                    <td><strong>{{ task.display_name or task.name }}</strong></td>
                    <td>{{ "%.2f"|format(task.revenue) }}</td>
                    <td class="tooltip" data-tooltip="{{ task.cost_tooltip }}">{{ "%.2f"|format(task.total_cost) }}</td>
                    <td>
                        {% if task.net_profit > 0 %}
                            <span class="profit-positive">{{ "%.2f"|format(task.net_profit) }}</span>
                        {% elif task.net_profit < 0 %}
                            <span class="profit-negative">{{ "%.2f"|format(task.net_profit) }}</span>
                        {% else %}
                            <span class="profit-zero">{{ "%.2f"|format(task.net_profit) }}</span>
                        {% endif %}
                    </td>
                    <td>{{ "%.1f"|format(task.base_time / 1000.0) }}</td>
                    <td>
                        {% if task.gold_efficiency > 0 %}
                            <span class="profit-positive">{{ "%.3f"|format(task.gold_efficiency) }}</span>
                        {% elif task.gold_efficiency < 0 %}
                            <span class="profit-negative">{{ "%.3f"|format(task.gold_efficiency) }}</span>
                        {% else %}
                            <span class="profit-zero">{{ "%.3f"|format(task.gold_efficiency) }}</span>
                        {% endif %}
                    </td>
                    <td>{{ "%.2f"|format(task.xp_efficiency) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="no-tasks">{{ _('No profitable tasks found in this category') }}</div>
        {% endif %}
    </div>
    {% endfor %}

    <div style="text-align: center; margin-top: 30px; padding: 20px; background-color: #f8f9fa; border-top: 1px solid #dee2e6;">
        <p style="color: #7f8c8d; margin: 10px 0;">{{ _('Last updated') }}: {{ timestamp }}</p>

        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #dee2e6;">
            <p style="color: #495057; font-size: 0.9em; margin: 5px 0;">
                <strong>üîß Enhanced Version:</strong>
                <a href="https://github.com/And0r-/Idle-Clans-Economy-Efficiency"
                   target="_blank"
                   style="color: #3498db; text-decoration: none; font-weight: bold;"
                   onmouseover="this.style.textDecoration='underline'"
                   onmouseout="this.style.textDecoration='none'">
                    And0r-/Idle-Clans-Economy-Efficiency
                </a>
            </p>
            <p style="color: #495057; font-size: 0.9em; margin: 5px 0;">
                <strong>üìö Original Project:</strong>
                <a href="https://github.com/Lyon-K/Idle-Clans-Economy-Efficiency"
                   target="_blank"
                   style="color: #27ae60; text-decoration: none; font-weight: bold;"
                   onmouseover="this.style.textDecoration='underline'"
                   onmouseout="this.style.textDecoration='none'">
                    Lyon-K/Idle-Clans-Economy-Efficiency
                </a>
            </p>
            <p style="color: #7f8c8d; font-size: 0.85em; margin-top: 10px;">
                {{ _('Built with ‚ù§Ô∏è for the Idle Clans community') }} |
                <a href="https://query.idleclans.com/api-docs/index.html"
                   target="_blank"
                   style="color: #7f8c8d; text-decoration: none;"
                   onmouseover="this.style.textDecoration='underline'"
                   onmouseout="this.style.textDecoration='none'">
                    {{ _('API Docs') }}
                </a>
            </p>
        </div>
    </div>

    <script>
        // Set current language in dropdown
        function getCurrentLanguage() {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'language') {
                    return value;
                }
            }
            return 'en'; // Default to English
        }

        // Set the dropdown to current language
        document.getElementById('languageSelect').value = getCurrentLanguage();

        // Change language function
        function changeLanguage() {
            const selectedLang = document.getElementById('languageSelect').value;

            fetch(`/set-language/${selectedLang}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Reload page to apply new language
                        location.reload();
                    }
                })
                .catch(error => {
                    console.error('Error setting language:', error);
                });
        }
    </script>
</body>
</html>